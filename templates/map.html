<!DOCTYPE html><html lang="en">    <head>        <meta charset="utf-8" />        <title>Liveability</title>        <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />{#        <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />#}        <meta http-equiv="X-UA-Compatible" content="IE=edge">        <meta content="width=device-width, initial-scale=1" name="viewport" />        <meta content="" name="description" />        <meta content="" name="author" />        {% load staticfiles %}        <!-- BEGIN GLOBAL MANDATORY STYLES -->{#        <link href="{% static '' %}mapbox-gl/dist/mapbox-gl.css" rel="stylesheet" type="text/css" />#}        <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.34.0/mapbox-gl.css' rel='stylesheet' />        <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v0.34.0/mapbox-gl.css" />        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />        <link href="{% static '' %}assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />        <link href="{% static '' %}assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />        <link href="{% static '' %}assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />        <link href="{% static '' %}assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css" />        <link href="{% static '' %}assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />        <link href="{% static '' %}assets/global/plugins/bootstrap-select/css/bootstrap-select.min.css" rel="stylesheet" type="text/css" />        <!-- END GLOBAL MANDATORY STYLES -->        <!-- BEGIN PAGE LEVEL PLUGINS -->        <!-- END PAGE LEVEL PLUGINS -->        <!-- BEGIN THEME GLOBAL STYLES -->        <link href="{% static '' %}assets/global/css/components.min.css" rel="stylesheet" id="style_components" type="text/css" />        <link href="{% static '' %}assets/global/css/plugins.min.css" rel="stylesheet" type="text/css" />        <link href="{% static '' %}noUiSlider/nouislider.min.css" rel="stylesheet" type="text/css" />        <!-- END THEME GLOBAL STYLES -->        <!-- BEGIN THEME LAYOUT STYLES -->        <link href="{% static '' %}assets/layouts/layout4/css/layout.min.css" rel="stylesheet" type="text/css" />        <link href="{% static '' %}assets/layouts/layout4/css/themes/light.min.css" rel="stylesheet" type="text/css" id="style_color" />        <link href="{% static '' %}assets/layouts/layout4/css/custom.min.css" rel="stylesheet" type="text/css" />        <link rel="stylesheet" href="{% static '' %}mapbox/leaflet.css" />{#        <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">#}        <style>         #map { height: 100%; margin: 0; padding: 0; overflow: hidden; }        .nicebox {          position: absolute;          text-align: center;          font-family: "Roboto", "Arial", sans-serif;          font-size: 13px;          z-index: 5;          box-shadow: 0 4px 6px -4px #333;          padding: 5px 10px;          background: rgb(182, 255, 199);          background: linear-gradient(to bottom, rgb(187, 195, 255) 0%, rgb(203, 245, 201) 100%);          border: rgb(229, 220, 225) 1px solid;        }        #controls {          top: 90px;          left: 180px;          width: 400px;          height: 70px;        }        #data-box {          top: 180px;          left: 50px;            width: 300px;          height: 55px;          line-height: 45px;          display: none;            background: #ffd3d8;        }        #census-variable {          width: 360px;          height: 20px;        }        #legend { display: flex; display: -webkit-box; padding-top: 7px }        .color-key {          background: linear-gradient(to right,          hsl(151, 83%, 34%) 0%,          hsl(127, 81%, 37%) 17%,          hsl(102, 78%, 41%) 33%,          hsl(78, 76%, 44%) 50%,          hsl(54, 74%, 47%) 67%,          hsl(42, 66%, 59%) 83%,          hsl(6, 51%, 71%) 100%);          flex: 1;          -webkit-box-flex: 1;          margin: 0 5px;          text-align: left;          font-size: 1.0em;          line-height: 1.0em;        }        #data-value { font-size: 1.2em; font-weight: bold }        #data-label { font-size: 1.2em; font-weight: normal; padding-right: 10px; }        #data-label:after { content: ':' }        #data-caret { margin-left: -5px; display: none; font-size: 14px; width: 14px}    </style>        <!-- END THEME LAYOUT STYLES -->    </head>    <body class="page-container-bg-solid page-header-fixed page-sidebar-closed-hide-logo page-footer-fixed bg-grey-steel bg-font-grey-steel">            <style>            .mapboxgl-popup {                max-width: 400px;                font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;            }        </style>        <!-- BEGIN HEADER -->        <div class="page-header navbar navbar-fixed-top bg-grey-salt bg-font-grey-salt">            <!-- BEGIN HEADER INNER -->            <div class="page-header-inner ">                <!-- BEGIN LOGO -->                <div class="page-logo" style="display: table">                    <div style="display:table-cell;vertical-align:middle;">                        <img src="{% static '' %}logo/logo_liveability_007.png" style="max-height:68px"/>                    </div>                </div>                <!-- END LOGO -->                <a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse" data-target=".navbar-collapse"> </a>                <!-- END PAGE TOP -->            </div>            <!-- END HEADER INNER -->        </div>        <div class="clearfix"> </div>        <div class="page-container">            <!-- BEGIN SIDEBAR -->            <div class="page-sidebar-wrapper">                <div class="page-sidebar navbar-collapse collapse bg-grey-steel bg-font-grey-steel">                    <ul class="page-sidebar-menu " data-keep-expanded="true" data-auto-scroll="false" data-slide-speed="220">                        <li class="heading">                            <h3 class="">  </h3>                        </li>                        <li class="nav-item  active open">                            <a class="nav-link nav-toggle bg-grey-salt bg-font-grey-salt">                                <i class="icon-map"></i>                                <span class="title ">Data on Map</span>                                <span class="selected"></span>                                <span class="arrow open"></span>                            </a>                            <ul class="sub-menu">                                <li class="nav-item  active">                                    <a  href="/map/" class="nav-link ">                                        <span class="title" >Info Map </span>                                        <span class="selected"></span>                                    </a>                                </li>                                <li class="nav-item  ">                                    <a href="#" class="nav-link ">                                        <span class="title">Map (coming soon) </span>                                    </a>                                </li>                            </ul>                        </li>                        <li class="nav-item">                            <a class="nav-link bg-grey-salt bg-font-grey-salt">                                <i class="icon-diamond"></i>                                <span class="title">Predictor</span>{#                                <span class="selected"></span>#}                                <span class="arrow"></span>                            </a>                            <ul class="sub-menu">                                <li class="nav-item ">                                    <a  href="/predictor/" class="nav-link ">                                        <span class="title" >District Predictor</span>{#                                        <span class="selected"></span>#}                                    </a>                                </li>                                <li class="nav-item  ">                                    <a href="#" class="nav-link ">                                        <span class="title">Predictor (coming soon) </span>                                    </a>                                </li>                            </ul>                        </li>                    </ul>                    <!-- END SIDEBAR MENU -->                </div>                <!-- END SIDEBAR -->            </div>            <!-- END SIDEBAR -->            <!-- BEGIN CONTENT -->            <div class="page-content-wrapper">                <div class="page-content">                    <div class="page-head">                        <!-- BEGIN PAGE TITLE -->                        <div class="page-title">                            <h1>Liveability                                <small>Info Map</small>                            </h1>                        </div>                        <!-- END PAGE TITLE -->                        <!-- BEGIN PAGE TOOLBAR -->                        <!-- END PAGE TOOLBAR -->                    </div>{#                    <div class="m-heading-1 border-green m-bordered">#}{#                        <p> Welcome !#}{#                        </p>#}{#                    </div>#}                    <div class="row">                        <div class="col-md-12">                            <div class="row">                                <div class="col-md-12">                                    <!-- BEGIN CHART PORTLET-->                                    <div class="portlet light bordered">                                        <div class="portlet-title">                                            <div class="caption">                                                <i class="icon-map font-green-haze"></i>                                                <span class="caption-subject bold uppercase font-green-haze"> Data on Map </span>                                                <span class="caption-helper">  </span>                                            </div>                                            <div class="tools">                                                <a href="javascript:;" class="collapse"> </a>                                                <a href="javascript:;" class="fullscreen"> </a>                                            </div>                                        </div>                                        <div class="portlet-body">{#                                            <div id="chartdiv" class="chart" style="height: 450px;"> </div>#}{#                                            <div id="mapid" class="chart" style="height: 900px;"></div>#}                                            <div id="controls" class="nicebox">                                                <div>                                                    <select id="census-variable">                                                        <option value=" ">                                                            2016 年「兩餸一湯」平均價格                                                        </option>                                                        <option value=" ">                                                            Primary School Ranking                                                        </option>                                                        <option value=" ">                                                            House Pricing                                                        </option>                                                        <option value=" ">                                                            Population                                                        </option>{#                                                        <option value=" ">#}{#                                                            #}{#                                                        </option>#}                                                    </select>                                                </div>                                                <div id="legend">                                                    <div id="census-min">min</div>                                                    <div class="color-key"><span id="data-caret">&#x25c6;</span></div>                                                    <div id="census-max">max</div>                                                </div>                                            </div>                                            <div id="data-box" class="nicebox">                                                <label id="data-label" for="data-value"></label>                                                <span id="data-value"></span>                                            </div>                                            <div id="map" class="chart"  style="height: 800px"></div>                                        </div>                                    </div>                                    <!-- END CHART PORTLET-->                                </div>                            </div>                        </div>                    </div>                    <!-- END PAGE BASE CONTENT -->                </div>                <!-- END CONTENT BODY -->            </div>            <!-- END CONTENT -->        </div>        <!-- END CONTAINER -->        <!-- BEGIN FOOTER -->        <div class="page-footer bg-grey-salt bg-font-grey-salt">            <div class="page-footer-inner "> 2017 &copy; HKSTP DATA STUDIO            </div>            <div class="scroll-to-top">                <i class="icon-arrow-up"></i>            </div>        </div>        <!-- END FOOTER -->        <!--[if lt IE 9]><script src="{% static '' %}assets/global/plugins/respond.min.js"></script><script src="{% static '' %}assets/global/plugins/excanvas.min.js"></script><![endif]-->        <!-- BEGIN CORE PLUGINS -->        <script src="{% static '' %}assets/global/plugins/jquery.min.js" type="text/javascript"></script>        <script src="{% static '' %}assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>        <script src="{% static '' %}assets/global/plugins/js.cookie.min.js" type="text/javascript"></script>        <script src="{% static '' %}assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>        <script src="{% static '' %}assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>        <script src="{% static '' %}assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>        <script src="{% static '' %}assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>        <script src="{% static '' %}assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>        <script src="{% static '' %}assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>        <script src="{% static '' %}assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>        <!-- END CORE PLUGINS -->        <!-- BEGIN PAGE LEVEL PLUGINS -->        <script src="{% static '' %}assets/global/plugins/amcharts/amcharts/amcharts.js" type="text/javascript"></script>        <script src="{% static '' %}assets/global/plugins/amcharts/amcharts/serial.js" type="text/javascript"></script>        <script src="{% static '' %}assets/global/plugins/amcharts/amcharts/pie.js" type="text/javascript"></script>        <script src="{% static '' %}assets/global/plugins/amcharts/amcharts/radar.js" type="text/javascript"></script>        <script src="{% static '' %}assets/global/plugins/amcharts/amcharts/themes/light.js" type="text/javascript"></script>        <script src="{% static '' %}assets/global/plugins/amcharts/amcharts/themes/patterns.js" type="text/javascript"></script>        <script src="{% static '' %}assets/global/plugins/amcharts/amcharts/themes/chalk.js" type="text/javascript"></script>{#        <script src="{% static '' %}assets/global/plugins/amcharts/ammap/ammap.js" type="text/javascript"></script>#}        <script src="{% static '' %}assets/global/plugins/amcharts/ammap/maps/js/worldLow.js" type="text/javascript"></script>{#        <script src="{% static '' %}assets/global/plugins/amcharts/amstockcharts/amstock.js" type="text/javascript"></script>#}        <!-- END PAGE LEVEL PLUGINS -->        <!-- BEGIN THEME GLOBAL SCRIPTS -->        <script src="{% static '' %}assets/global/scripts/app.min.js" type="text/javascript"></script>        <!-- END THEME GLOBAL SCRIPTS -->        <!-- BEGIN PAGE LEVEL SCRIPTS -->        <script src="{% static '' %}assets/pages/scripts/charts-amcharts.min.js" type="text/javascript"></script>        <script src="{% static '' %}noUiSlider/nouislider.min.js" type="text/javascript"></script>        <!-- END PAGE LEVEL SCRIPTS -->        <!-- BEGIN THEME LAYOUT SCRIPTS -->        <script src="{% static '' %}assets/layouts/layout4/scripts/layout.min.js" type="text/javascript"></script>        <script src="{% static '' %}assets/layouts/layout4/scripts/demo.min.js" type="text/javascript"></script>        <script src="{% static '' %}assets/layouts/global/scripts/quick-sidebar.min.js" type="text/javascript"></script>{#        <script src="{% static '' %}am_js/ammap.js"></script>#}{#        <script src="{% static '' %}am_js/hongKongHigh.js"></script>#}{#        <script src="{% static '' %}am_js/light.js"></script>#}{#        <script src="{% static '' %}mapbox/leaflet.js"></script>#}{#        <script src="{% static '' %}mapbox-gl/test/unit/mapbox-gl.js" type="text/javascript"></script>#}{#        'https://api.tiles.mapbox.com/mapbox-gl-js/v0.34.0/mapbox-gl.js'#}{#                <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.34.0/mapbox-gl.js' type="text/javascript"></script>#}{#        <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.34.0/mapbox-gl.js'></script>#}{#        <script>#}{#            var mymap = L.map('mapid').setView([22.3964, 114.1095], 10.5);#}{#            L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/streets-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoicGhhcnJlbGx6eCIsImEiOiJjajBsMjQ3cnAwMjU2MzJuMm03MTZiNnViIn0.Sc3bjw_fx8nMe6i4l7Fb7A', {#}{#                attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',#}{#                maxZoom: 18,#}{#                id: 'your.mapbox.project.id',#}{#                accessToken: 'your.mapbox.public.access.token'#}{#            }).addTo(mymap);#}{##}{#            var marker = L.marker([22.286394, 114.149139]).addTo(mymap);#}{##}{##}{#            var circle = L.circle([22.296394, 114.159139], {#}{#                color: 'red',#}{#                fillColor: '#f03',#}{#                fillOpacity: 0.5,#}{#                radius: 500#}{#            }).addTo(mymap);#}{#            var polygon = L.polygon([#}{#                [22.286394, 114.149139],#}{#                [22.287394, 114.149339],#}{#                [22.288394, 114.149539]#}{#            ]).addTo(mymap);#}{##}{##}{#            marker.bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup();#}{##}{##}{#            circle.bindPopup("I am a circle.");#}{#            polygon.bindPopup("I am a polygon.");#}{##}{#            var popup = L.popup()#}{#                .setLatLng([22.333394, 114.19139])#}{#                .setContent("I am a standalone popup.")#}{#                .openOn(mymap);#}{##}{#            function onMapClick(e) {#}{#                alert("You clicked the map at " + e.latlng);#}{#            }#}{##}{#            mymap.on('click', onMapClick);#}{#        </script>#}        <script>      var mapStyle = [{        'stylers': [{'visibility': 'off'}]      }, {        'featureType': 'landscape',        'elementType': 'geometry',        'stylers': [{'visibility': 'on'}, {'color': '#fcfcfc'}]      }, {        'featureType': 'water',        'elementType': 'geometry',        'stylers': [{'visibility': 'on'}, {'color': '#bfd4ff'}]      }];      var map;      var censusMin = Number.MAX_VALUE, censusMax = -Number.MAX_VALUE;      function initMap() {        // load the map        map = new google.maps.Map(document.getElementById('map'), {          center: {lat: 22.326394, lng: 114.149139},          zoom: 11,          styles: mapStyle        });        // set up the style rules and events for google.maps.Data        map.data.setStyle(styleFeature);        map.data.addListener('mouseover', mouseInToRegion);        map.data.addListener('mouseout', mouseOutOfRegion);{##}        // wire up the button        var selectBox = document.getElementById('census-variable');        google.maps.event.addDomListener(selectBox, 'change', function() {          clearCensusData();          loadCensusData(selectBox.options[selectBox.selectedIndex].value);        });        // state polygons only need to be loaded once, do them now        loadMapShapes();      }      /** Loads the state boundary polygons from a GeoJSON source. */      function loadMapShapes() {        // load US state outline polygons from a GeoJson file        map.data.loadGeoJson("{% static '' %}geojson/hk.json", { idPropertyName: 'ID_1' });        // wait for the request to complete by listening for the first feature to be        // added        google.maps.event.addListenerOnce(map.data, 'addfeature', function() {          google.maps.event.trigger(document.getElementById('census-variable'),              'change');        });      }      /**       * Loads the census data from a simulated API call to the US Census API.       *       * @param {string} variable       */      function loadCensusData(variable) {        // load the requested variable from the census API (using local copies)        var xhr = new XMLHttpRequest();{#        xhr.open('GET', variable + '.json');#}        xhr.open('GET','{% static '' %}json_data/sample.json');        xhr.onload = function() {          var censusData = JSON.parse(xhr.responseText);          censusData.shift(); // the first row contains column names          censusData.forEach(function(row) {            var censusVariable = parseFloat(row[0]);            var stateId = row[1];            console.log(censusVariable)            // keep track of min and max values            if (censusVariable < censusMin) {              censusMin = censusVariable;            }            if (censusVariable > censusMax) {              censusMax = censusVariable;            }            // update the existing row with the new data            map.data              .getFeatureById(stateId)              .setProperty('census_variable', censusVariable);          });          // update and display the legend          document.getElementById('census-min').textContent =              censusMin.toLocaleString();          document.getElementById('census-max').textContent =              censusMax.toLocaleString();        };        xhr.send();      }      /** Removes census data from each shape on the map and resets the UI. */      function clearCensusData() {        censusMin = Number.MAX_VALUE;        censusMax = -Number.MAX_VALUE;        map.data.forEach(function(row) {          row.setProperty('census_variable', undefined);        });        document.getElementById('data-box').style.display = 'none';        document.getElementById('data-caret').style.display = 'none';      }      /**       * Applies a gradient style based on the 'census_variable' column.       * This is the callback passed to data.setStyle() and is called for each row in       * the data set.  Check out the docs for Data.StylingFunction.       *       * @param {google.maps.Data.Feature} feature       */      function styleFeature(feature) {        var high = [5, 69, 54];  // color of smallest datum        var low = [151, 83, 34];   // color of largest datum        // delta represents where the value sits between the min and max        var delta = (feature.getProperty('census_variable') - censusMin) /            (censusMax - censusMin);        var color = [];        for (var i = 0; i < 3; i++) {          // calculate an integer color based on the delta          color[i] = (high[i] - low[i]) * delta + low[i];        }        // determine whether to show this shape or not        var showRow = true;        if (feature.getProperty('census_variable') == null ||            isNaN(feature.getProperty('census_variable'))) {          showRow = false;        }        var outlineWeight = 0.5, zIndex = 1;        if (feature.getProperty('state') === 'hover') {          outlineWeight = zIndex = 2;        }        return {          strokeWeight: outlineWeight,          strokeColor: '#fff',          zIndex: zIndex,          fillColor: 'hsl(' + color[0] + ',' + color[1] + '%,' + color[2] + '%)',          fillOpacity: 0.75,          visible: showRow        };      }      /**       * Responds to the mouse-in event on a map shape (state).       *       * @param {?google.maps.MouseEvent} e       */      function mouseInToRegion(e) {        // set the hover state so the setStyle function can change the border        e.feature.setProperty('state', 'hover');        var percent = (e.feature.getProperty('census_variable') - censusMin) /            (censusMax - censusMin) * 100;        // update the label        document.getElementById('data-label').textContent =            e.feature.getProperty('name');        document.getElementById('data-value').textContent =            e.feature.getProperty('census_variable');        document.getElementById('data-box').style.display = 'block';        document.getElementById('data-caret').style.display = 'block';        document.getElementById('data-caret').style.paddingLeft = percent + '%';      }      /**       * Responds to the mouse-out event on a map shape (state).       *       * @param {?google.maps.MouseEvent} e       */      function mouseOutOfRegion(e) {        // reset the hover state, returning the border to normal        e.feature.setProperty('state', 'normal');      }    </script>    <script async defer        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDohL9LiqVz-Eah7amMrQBZ4C5SckOI08c&callback=initMap">    </script>{##}{##}{#        <script>#}{#mapboxgl.accessToken = 'pk.eyJ1IjoicGhhcnJlbGx6eCIsImEiOiJjajBsMjQ3cnAwMjU2MzJuMm03MTZiNnViIn0.Sc3bjw_fx8nMe6i4l7Fb7A';#}{#var map = new mapboxgl.Map({#}{#    container: 'map',#}{#    style: 'mapbox://styles/mapbox/streets-v9',#}{#    center: [22.286394, 114.149139],#}{#    zoom: 11#}{#});#}{##}{#map.on('load', function () {#}{##}{#    // Add a layer showing the state polygons.#}{#    map.addLayer({#}{#        'id': 'states-layer',#}{#        'type': 'fill',#}{#        'source': {#}{#            'type': 'geojson',#}{#            'data': '{% static '' %}geojson/hk.json'#}{#        },#}{#        'paint': {#}{#            'fill-color': 'rgba(200, 100, 240, 0.4)',#}{#            'fill-outline-color': 'rgba(200, 100, 240, 1)'#}{#        }#}{#    });#}{#});#}{##}{##}{#// When a click event occurs near a polygon, open a popup at the location of#}{#// the feature, with description HTML from its properties.#}{#map.on('click', function (e) {#}{#    var features = map.queryRenderedFeatures(e.point, { layers: ['states-layer'] });#}{#    if (!features.length) {#}{#        return;#}{#    }#}{##}{#    var feature = features[0];#}{##}{#    var popup = new mapboxgl.Popup()#}{#        .setLngLat(map.unproject(e.point))#}{#        .setHTML(feature.properties.name)#}{#        .addTo(map);#}{#});#}{##}{#// Use the same approach as above to indicate that the symbols are clickable#}{#// by changing the cursor style to 'pointer'.#}{#map.on('mousemove', function (e) {#}{#    var features = map.queryRenderedFeatures(e.point, { layers: ['states-layer'] });#}{#    map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';#}{#});#}{#</script>#}        <!-- END THEME LAYOUT SCRIPTS -->    </body></html>